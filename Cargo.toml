[package]
authors = ["The Cloud Hypervisor Authors"]
build = "build.rs"
description = "Open source Virtual Machine Monitor (VMM) that runs on top of KVM & MSHV"
edition = "2021"
homepage = "https://github.com/cloud-hypervisor/cloud-hypervisor"
license = "Apache-2.0 AND BSD-3-Clause"
name = "cloud-hypervisor"
version = "42.0.0"
# Minimum buildable version:
# Keep in sync with version in .github/workflows/build.yaml
# Policy on MSRV (see #4318):
# Can only be bumped by:
# a.) A dependency requires it,
# b.) If we want to use a new feature and that MSRV is at least 6 months old,
# c.) There is a security issue that is addressed by the toolchain update.
rust-version = "1.77.0"

[[bin]]
name = "cloud-hypervisor"
path = "src/main.rs"

[[bin]]
name = "ch-remote"
path = "src/bin/ch-remote.rs"

[[bin]]
name = "vmm-service"
path = "src/bin/vmm-service.rs"

[[bin]]
name = "vmm-service-test"
path = "src/bin/vmm-service-test.rs"

[profile.release]
codegen-units = 1
lto = true
opt-level = "s"
strip = true

[profile.profiling]
debug = true
inherits = "release"
strip = false

[dependencies]
anyhow = "1.0.87"
api_client = { path = "api_client" }
clap = { version = "4.5.13", features = ["string"] }
dhat = { version = "0.3.3", optional = true }
env_logger = "0.10"
simple_logger = "4.3.0"
epoll = "4.3.3"
event_monitor = { path = "event_monitor" }
hypervisor = { path = "hypervisor" }
libc = "0.2.158"
log = { version = "0.4.22", features = ["std"] }
option_parser = { path = "option_parser" }
seccompiler = { workspace = true }
serde_json = "1.0.120"
signal-hook = "0.3.17"
thiserror = "1.0.62"
tpm = { path = "tpm" }
tracer = { path = "tracer" }
vm-memory = { workspace = true }
vmm = { path = "vmm" }
vmm-service = { path = "vmm-service" }
vmm-sys-util = { workspace = true }
tokio = { version = "1.42.0", features = [ "full" ] }
zbus = { version = "4.4.0", optional = true }
conductor = { git = "https://github.com/versatus/conductor" }
async-trait = "0.1.80"
dialoguer = "0.11.0"
# TODO: Use github or deploy these to crates.io for proper use
form-types = { path = "../form-types" }
form-traits = { path = "../form-traits" }

[dev-dependencies]
dirs = "5.0.1"
net_util = { path = "net_util" }
once_cell = "1.20.2"
serde_json = "1.0.120"
test_infra = { path = "test_infra" }
wait-timeout = "0.2.0"

# Please adjust `vmm::feature_list()` accordingly when changing the
# feature list below
[features]
dbus_api = ["vmm/dbus_api", "zbus"]
default = ["io_uring", "kvm"]
dhat-heap = ["dhat", "vmm/dhat-heap"]       # For heap profiling
guest_debug = ["vmm/guest_debug"]
igvm = ["mshv", "vmm/igvm"]
io_uring = ["vmm/io_uring"]
kvm = ["vmm/kvm"]
mshv = ["vmm/mshv"]
pvmemcontrol = ["vmm/pvmemcontrol"]
sev_snp = ["igvm", "mshv", "vmm/sev_snp"]
tdx = ["vmm/tdx"]
tracing = ["tracer/tracing", "vmm/tracing"]

[workspace]
members = [
  "api_client",
  "arch",
  "block",
  "devices",
  "event_monitor",
  "hypervisor",
  "net_gen",
  "net_util",
  "option_parser",
  "pci",
  "performance-metrics",
  "rate_limiter",
  "serial_buffer",
  "test_infra",
  "tracer",
  "vhost_user_block",
  "vhost_user_net",
  "virtio-devices",
  "vm-allocator",
  "vm-device",
  "vm-migration",
  "vm-virtio",
  "vmm",
  "vmm-service",
]

[workspace.dependencies]
acpi_tables = { git = "https://github.com/rust-vmm/acpi_tables", branch = "main" }
kvm-bindings = "0.10.0"
kvm-ioctls = "0.19.0"
linux-loader = "0.13.0"
mshv-bindings = "0.3.1"
mshv-ioctls = "0.3.1"
seccompiler = "0.4.0"
vfio-bindings = { git = "https://github.com/rust-vmm/vfio", branch = "main" }
vfio-ioctls = { git = "https://github.com/rust-vmm/vfio", branch = "main", default-features = false }
vfio_user = { git = "https://github.com/rust-vmm/vfio-user", branch = "main" }
vhost = { git = "https://github.com/rust-vmm/vhost", rev = "d983ae0" }
vhost-user-backend = { git = "https://github.com/rust-vmm/vhost", rev = "d983ae0" }
virtio-bindings = "0.2.4"
virtio-queue = "0.14.0"
vm-fdt = { git = "https://github.com/rust-vmm/vm-fdt", branch = "main" }
vm-memory = "0.16.0"
vmm-sys-util = "0.12.1"
